{"primaryContentSections":[{"kind":"content","content":[{"anchor":"Overview","level":2,"text":"Overview","type":"heading"},{"inlineContent":[{"type":"text","text":"APIServerは、"},{"code":"AuthMiddleware","type":"codeVoice"},{"type":"text","text":"と"},{"code":"AuthenticationProvider","type":"codeVoice"},{"type":"text","text":"プロトコルを使用して"},{"type":"text","text":" "},{"type":"text","text":"柔軟な認証システムを提供します。"}],"type":"paragraph"},{"anchor":"AuthenticationProvider-%E3%81%AE%E5%AE%9F%E8%A3%85","level":2,"text":"AuthenticationProvider の実装","type":"heading"},{"inlineContent":[{"type":"text","text":"認証ロジックをカスタマイズするには、"},{"type":"codeVoice","code":"AuthenticationProvider"},{"type":"text","text":"プロトコルを実装します："}],"type":"paragraph"},{"syntax":"swift","code":["struct MyAuthProvider: AuthenticationProvider {","    func authenticate(token: String) async throws -> String? {","        \/\/ トークンを検証","        \/\/ 有効な場合はユーザーIDを返す","        \/\/ 無効な場合はnilを返す","","        \/\/ 例: JWTトークンの検証","        guard let userId = try? verifyJWT(token) else {","            return nil","        }","        return userId","    }","}"],"type":"codeListing"},{"anchor":"AuthMiddleware-%E3%81%AE%E8%A8%AD%E5%AE%9A","level":2,"text":"AuthMiddleware の設定","type":"heading"},{"syntax":"swift","code":["let authProvider = MyAuthProvider()","app.middleware.use(AuthMiddleware(provider: authProvider))"],"type":"codeListing"},{"anchor":"%E8%AA%8D%E8%A8%BC%E7%8A%B6%E6%85%8B%E3%81%B8%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9","level":2,"text":"認証状態へのアクセス","type":"heading"},{"inlineContent":[{"text":"APIContract ハンドラ内で認証されたユーザーにアクセス：","type":"text"}],"type":"paragraph"},{"syntax":"swift","code":["try app.mount(ProfileAPI.self) { context in","    \/\/ 認証が必要なエンドポイント","    guard let userId = context.authenticatedUserId else {","        throw APIContractError.unauthorized(message: \"Authentication required\")","    }","","    \/\/ ユーザー情報を取得して返す","    let user = try await fetchUser(id: userId)","    return ProfileOutput(id: userId, name: user.name)","}"],"type":"codeListing"},{"anchor":"%E8%AA%8D%E8%A8%BC%E3%81%AE%E3%82%B9%E3%82%AD%E3%83%83%E3%83%97","level":2,"text":"認証のスキップ","type":"heading"},{"inlineContent":[{"type":"text","text":"特定のエンドポイントで認証をスキップするには、"},{"type":"text","text":" "},{"code":"AuthMiddleware","type":"codeVoice"},{"text":"を使用しないルートグループを作成するか、","type":"text"},{"text":" ","type":"text"},{"text":"ミドルウェア内で特定のパスを除外します：","type":"text"}],"type":"paragraph"},{"code":["struct ConditionalAuthMiddleware: ServerMiddleware {","    let provider: AuthenticationProvider","    let excludedPaths: Set<String>","","    func respond(","        to request: ServerRequest,","        chainingTo next: @escaping (ServerRequest) async throws -> ServerResponse","    ) async throws -> ServerResponse {","        \/\/ 除外パスの場合は認証をスキップ","        if excludedPaths.contains(request.url.path) {","            return try await next(request)","        }","","        \/\/ 通常の認証処理","        \/\/ ...","    }","}","","app.middleware.use(ConditionalAuthMiddleware(","    provider: MyAuthProvider(),","    excludedPaths: [\"\/health\", \"\/public\"]","))"],"syntax":"swift","type":"codeListing"},{"level":2,"text":"Bearer トークン形式","anchor":"Bearer-%E3%83%88%E3%83%BC%E3%82%AF%E3%83%B3%E5%BD%A2%E5%BC%8F","type":"heading"},{"inlineContent":[{"code":"AuthMiddleware","type":"codeVoice"},{"type":"text","text":"は以下の形式のAuthorizationヘッダーを期待します："}],"type":"paragraph"},{"code":["Authorization: Bearer <token>"],"syntax":null,"type":"codeListing"},{"inlineContent":[{"text":"トークンの部分が","type":"text"},{"code":"AuthenticationProvider.authenticate(token:)","type":"codeVoice"},{"text":"メソッドに渡されます。","type":"text"}],"type":"paragraph"}]}],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/APIServer\/documentation\/APIServer\/Authentication"},"sections":[],"kind":"article","variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/apiserver\/authentication"]}],"metadata":{"title":"認証","role":"article","modules":[{"name":"APIServer"}],"roleHeading":"Article"},"abstract":[{"type":"text","text":"Bearer トークンによる認証を実装する方法を学びます。"}],"seeAlsoSections":[{"title":"認証","identifiers":["doc:\/\/APIServer\/documentation\/APIServer\/AuthenticatedUser"],"anchor":"認証","generated":true}],"schemaVersion":{"minor":3,"major":0,"patch":0},"hierarchy":{"paths":[["doc:\/\/APIServer\/documentation\/APIServer"]]},"references":{"doc://APIServer/documentation/APIServer/AuthenticatedUser":{"url":"\/documentation\/apiserver\/authenticateduser","identifier":"doc:\/\/APIServer\/documentation\/APIServer\/AuthenticatedUser","abstract":[{"type":"text","text":"認証済みユーザーを表す型"}],"fragments":[{"kind":"keyword","text":"struct"},{"kind":"text","text":" "},{"kind":"identifier","text":"AuthenticatedUser"}],"kind":"symbol","role":"symbol","title":"AuthenticatedUser","navigatorTitle":[{"kind":"identifier","text":"AuthenticatedUser"}],"type":"topic"},"doc://APIServer/documentation/APIServer":{"url":"\/documentation\/apiserver","type":"topic","abstract":[{"text":"Vaporウェブフレームワークの抽象化レイヤー。","type":"text"}],"identifier":"doc:\/\/APIServer\/documentation\/APIServer","role":"collection","kind":"symbol","title":"APIServer"}}}