{"primaryContentSections":[{"content":[{"text":"Overview","type":"heading","level":2,"anchor":"Overview"},{"type":"paragraph","inlineContent":[{"text":"APIServerは、アプリケーションコードをVapor固有の実装から独立させることを","type":"text"},{"text":" ","type":"text"},{"text":"目的として設計されています。","type":"text"}]},{"text":"設計原則","type":"heading","level":2,"anchor":"%E8%A8%AD%E8%A8%88%E5%8E%9F%E5%89%87"},{"text":"1. 依存性の隠蔽","type":"heading","level":3,"anchor":"1-%E4%BE%9D%E5%AD%98%E6%80%A7%E3%81%AE%E9%9A%A0%E8%94%BD"},{"type":"paragraph","inlineContent":[{"text":"Vaporは","type":"text"},{"code":"Internal\/","type":"codeVoice"},{"text":"ディレクトリ内に隠蔽され、公開APIには現れません：","type":"text"}]},{"syntax":null,"type":"codeListing","code":["Sources\/APIServer\/","├── Core\/                    # 公開プロトコル","│   ├── ServerApplication.swift","│   ├── ServerEnvironment.swift","│   └── HTTPStatus.swift","├── Internal\/                # Vapor実装（非公開）","│   ├── VaporServerApplication.swift","│   └── VaporRouteRegistrar.swift","└── ..."]},{"text":"2. プロトコル優先","type":"heading","level":3,"anchor":"2-%E3%83%97%E3%83%AD%E3%83%88%E3%82%B3%E3%83%AB%E5%84%AA%E5%85%88"},{"type":"paragraph","inlineContent":[{"type":"text","text":"すべての抽象化はSwiftプロトコルで定義されています："}]},{"syntax":"swift","type":"codeListing","code":["public protocol ServerApplication: Sendable {","    var routes: any RouteRegistrar { get }","    var logger: any ServerLogger { get }","    var middleware: MiddlewareConfiguration { get }","","    func run() async throws","    func shutdown() async throws","}","","public protocol ServerMiddleware: Sendable {","    func respond(","        to request: ServerRequest,","        chainingTo next: @escaping (ServerRequest) async throws -> ServerResponse","    ) async throws -> ServerResponse","}"]},{"text":"3. Sendable準拠","type":"heading","level":3,"anchor":"3-Sendable%E6%BA%96%E6%8B%A0"},{"type":"paragraph","inlineContent":[{"text":"Swift 6の厳格な並行処理に対応するため、すべての公開型は","type":"text"},{"code":"Sendable","type":"codeVoice"},{"text":"を採用：","type":"text"}]},{"syntax":"swift","type":"codeListing","code":["public struct HTTPStatus: Sendable, Equatable {","    public let code: Int","    public let reasonPhrase: String","}","","public struct CORSMiddleware: ServerMiddleware, Sendable {","    \/\/ ...","}"]},{"text":"4. ファクトリパターン","type":"heading","level":3,"anchor":"4-%E3%83%95%E3%82%A1%E3%82%AF%E3%83%88%E3%83%AA%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"},{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":"Server.create()"},{"text":"による依存性注入を採用：","type":"text"}]},{"syntax":"swift","type":"codeListing","code":["public enum Server {","    public static func create(environment: ServerEnvironment) throws -> any ServerApplication {","        try VaporServerApplication(environment: environment)","    }","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"これにより、将来的に異なる実装（Hummingbird等）への切り替えが容易になります。"}]},{"text":"レイヤー構造","type":"heading","level":2,"anchor":"%E3%83%AC%E3%82%A4%E3%83%A4%E3%83%BC%E6%A7%8B%E9%80%A0"},{"syntax":null,"type":"codeListing","code":["┌─────────────────────────────────────┐","│         Application Code            │","│  (APIContract, Business Logic)      │","├─────────────────────────────────────┤","│          APIServer                  │","│  (Protocols, Abstractions)          │","├─────────────────────────────────────┤","│         Internal\/                   │","│    (Vapor Implementations)          │","├─────────────────────────────────────┤","│           Vapor                     │","│   (HTTP Server, Routing, etc.)      │","└─────────────────────────────────────┘"]},{"text":"将来の拡張性","type":"heading","level":2,"anchor":"%E5%B0%86%E6%9D%A5%E3%81%AE%E6%8B%A1%E5%BC%B5%E6%80%A7"},{"type":"paragraph","inlineContent":[{"text":"この設計により、以下の拡張が可能です：","type":"text"}]},{"items":[{"content":[{"inlineContent":[{"inlineContent":[{"text":"別のWebフレームワーク","type":"text"}],"type":"strong"},{"type":"text","text":": Hummingbird等への移行"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"inlineContent":[{"text":"サーバーレス","type":"text"}],"type":"strong"},{"text":": AWS Lambda、Cloud Functions対応","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"inlineContent":[{"text":"テストダブル","type":"text"}],"type":"strong"},{"text":": モック実装によるユニットテスト","type":"text"}],"type":"paragraph"}]},{"content":[{"inlineContent":[{"type":"strong","inlineContent":[{"type":"text","text":"カスタム実装"}]},{"text":": 特定のユースケース向けの最適化","type":"text"}],"type":"paragraph"}]}],"type":"orderedList"},{"text":"詳細情報","type":"heading","level":2,"anchor":"%E8%A9%B3%E7%B4%B0%E6%83%85%E5%A0%B1"},{"type":"paragraph","inlineContent":[{"text":"設計の詳細については、プロジェクトルートの","type":"text"},{"text":" ","type":"text"},{"code":"DESIGN.md","type":"codeVoice"},{"text":"を参照してください。","type":"text"}]}],"kind":"content"}],"sections":[],"metadata":{"modules":[{"name":"APIServer"}],"role":"article","title":"アーキテクチャ","roleHeading":"Article"},"hierarchy":{"paths":[["doc:\/\/APIServer\/documentation\/APIServer"]]},"seeAlsoSections":[{"identifiers":["doc:\/\/APIServer\/documentation\/APIServer\/GettingStarted"],"generated":true,"anchor":"はじめに","title":"はじめに"}],"variants":[{"traits":[{"interfaceLanguage":"swift"}],"paths":["\/documentation\/apiserver\/architecture"]}],"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/APIServer\/documentation\/APIServer\/Architecture"},"kind":"article","schemaVersion":{"minor":3,"major":0,"patch":0},"abstract":[{"type":"text","text":"APIServerの設計思想と内部構造を理解します。"}],"references":{"doc://APIServer/documentation/APIServer":{"identifier":"doc:\/\/APIServer\/documentation\/APIServer","title":"APIServer","abstract":[{"text":"Vaporウェブフレームワークの抽象化レイヤー。","type":"text"}],"kind":"symbol","role":"collection","url":"\/documentation\/apiserver","type":"topic"},"doc://APIServer/documentation/APIServer/GettingStarted":{"identifier":"doc:\/\/APIServer\/documentation\/APIServer\/GettingStarted","type":"topic","url":"\/documentation\/apiserver\/gettingstarted","kind":"article","title":"はじめに","role":"article","abstract":[{"text":"APIServerを使ってVaporベースのサーバーを構築する基本的な方法を学びます。","type":"text"}]}}}